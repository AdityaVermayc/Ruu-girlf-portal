<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
<div class="dashboard-container">
    <div class="dashboard-box">
        <h2>Grievances Dashboard</h2>

        <div class="grievance-list">
            {% for grievance in grievances %}
            <div class="grievance-item">

                <!-- grievance indexes (IMPORTANT)
                0 id
                1 title
                2 description
                3 mood
                4 priority
                5 response
                6 status
                -->

                <h3>{{ grievance[1] }}</h3>

                <p><strong>Description:</strong> {{ grievance[2] }}</p>
                <p><strong>Mood:</strong> {{ grievance[3] }}</p>
                <p><strong>Priority:</strong> {{ grievance[4] }}</p>

                <!-- STATUS -->
                <p>
                    <strong>Status:</strong>
                    {% if grievance[6] == 'Resolved' %}
                        ✅ Resolved
                    {% else %}
                        ❌ Pending
                    {% endif %}
                </p>

                <!-- RESPONSE -->
                <p>
                    <strong>Response:</strong>
                    {% if grievance[5] and grievance[5].strip() %}
                        {{ grievance[5] }}
                    {% else %}
                        None yet
                    {% endif %}
                </p>

                <!-- RESPONSE FORM -->
                {% if not (grievance[5] and grievance[5].strip()) %}
                <form method="POST" action="{{ url_for('respond', gid=grievance[0]) }}">
                    <textarea
                        name="response"
                        placeholder="Type your response here..."
                        rows="3"
                        required
                    ></textarea>
                    <button type="submit">Submit Response</button>
                </form>
                {% else %}
                    <p style="color: green;"><strong>✅ You have already responded.</strong></p>
                {% endif %}

                <!-- RESOLVE BUTTON -->
                {% if grievance[6] == 'Resolved' %}
                    <button
                        style="background-color:#28a745; color:white; cursor:not-allowed;"
                        disabled
                    >
                        ✅ Resolved
                    </button>
                {% else %}
                    <a href="{{ url_for('resolve', gid=grievance[0]) }}">
                        <button style="background-color:#dc3545; color:white;">
                            Mark as Resolved
                        </button>
                    </a>
                {% endif %}

            </div>
            {% endfor %}
        </div>

        <a href="{{ url_for('dashboard') }}" class="btn">Refresh</a>

    </div>
</div>
</body>
</html>
